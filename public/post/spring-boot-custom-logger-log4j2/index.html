<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
        <title>Unit testing a static custom logger in Spring Boot and log4j2 | Alessandro Baffa</title>
        <meta name="description" content="Unit testing a static custom logger in Spring Boot and log4j2">
        <meta property="og:site_name" content="Unit testing a static custom logger in Spring Boot and log4j2" />
        <meta property="og:title" content="Alessandro Baffa" />
        <meta property="og:description" content="Last time I wrote a post about how to unit test a custom logger with log4j2. Today I migrated another custom logger from log4j 1.x to log4j 2.x, but this time it was encapsulated in a Spring Boot component as a static class attribute.
Custom logger You have a simple custom logger
public class SimpleCustomLogger { private final ExtendedLoggerWrapper log; private SimpleCustomLogger(final Logger log) { this.log = new ExtendedLoggerWrapper((AbstractLogger) log, log."/>
        <meta property="og:image" content="https://alebaffa.github.io/images/author.png" />
    
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
    
    <meta name="keywords" content="fast, hugo, theme, minimal, gruvbox">
    <link rel="icon" type="image/svg" href='https://alebaffa.github.io'/>
    <meta name="author" content='jane_doe'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.68.3" />
    
    <link rel="stylesheet" href="https://alebaffa.github.io/sass/main.min.2ec5574c3cc6d0e06666d718ad1606a880afc23333cec89d3843ff7e4db2bfe8.css" type="text/css" media="screen" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css" />

    

    

    
    </head>

<body>
      <div class="line" id="scrollIndicator"></div>
      <div class="main"><div class="title">
  <div class="name">
    <h2><a href="https://alebaffa.github.io"
	   style="text-decoration: none; color: inherit;">Hi!</a></h2>
  </div>
  <div class="color-scheme">
    <input type="checkbox" class="checkbox" id="chk" />
    <label class="label" for="chk">
      <i class="fas fa-moon"></i>
      <i class="fas fa-sun"></i>
      <div class="ball"></div>
    </label>
  </div>
</div>
<script>
  const themeSetter = (theme) => {
      document.body.classList.toggle('dark')
      localStorage.setItem('theme', theme)
      blockSwitcher()
  }

  const blockSwitcher = () => [...document.getElementsByTagName("BLOCKQUOTE")]
	.forEach(b => b.classList.toggle('dark'))

  const styleSwapper = () => {
      document.body.classList.add('back-transition')
      if (localStorage.getItem('theme') === 'dark') themeSetter('light')
      else if (localStorage.getItem('theme') === 'light') themeSetter('dark')
  }

  if (localStorage.getItem('theme') === 'dark'){
      themeSetter('dark')
      document.addEventListener("DOMContentLoaded", blockSwitcher)
  }
 else localStorage.setItem('theme', 'light')

  document.getElementById('chk').addEventListener('change',styleSwapper);

  window.addEventListener("scroll", () => {
      let height = document.documentElement.scrollHeight
          - document.documentElement.clientHeight;
      if(height >= 500){
	  let winScroll = document.body.scrollTop
              || document.documentElement.scrollTop;
	  let scrolled = (winScroll / height) * 100;
	  document.getElementById("scrollIndicator").style.width = scrolled + "%";
      }
  });
</script>

<section class="intro">
    
    <div class="post-header">
    <h2 class="post-title"><a class="go-back" href="https://alebaffa.github.io/post/">
	      <i class="far fa-caret-square-left"></i></a> Unit testing a static custom logger in Spring Boot and log4j2</h2>
    </div>
    
    <p>By <a href="">Alessandro</a></p>
    
    <p class="post-dets">Published on: March 23, 2018
        | Reading Time: 2 min | Last Modified : March 23, 2018
        <br>
    </p>
    <span class="tags">
        
        <h5><a class="tag" href='https://alebaffa.github.io/tags/spring-boot'>spring-boot</a></h5>
        
        <h5><a class="tag" href='https://alebaffa.github.io/tags/log4j2'>log4j2</a></h5>
        
        <h5><a class="tag" href='https://alebaffa.github.io/tags/unit%20test'>unit test</a></h5>
        
    </span>
    
    <div class="content">
        <p>Last time I wrote a post about <a href="https://www.alebaffa.com/2018/03/17/unit-testing-custom-logger-log4j2/">how to unit test a custom logger with log4j2</a>. Today I migrated another custom logger from log4j 1.x to log4j 2.x, but this time it was encapsulated in a Spring Boot component as a static class attribute.</p>
<h2 id="custom-logger">Custom logger</h2>
<p>You have a simple custom logger</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleCustomLogger</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> ExtendedLoggerWrapper log<span style="color:#f92672">;</span>

  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">SimpleCustomLogger</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Logger log<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">log</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ExtendedLoggerWrapper<span style="color:#f92672">((</span>AbstractLogger<span style="color:#f92672">)</span> log<span style="color:#f92672">,</span> 
                            log<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(),</span> log<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessageFactory</span><span style="color:#f92672">());</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">synchronized</span> SimpleCustomLogger <span style="color:#a6e22e">getLogger</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Class<span style="color:#f92672">&lt;?&gt;</span> clazz<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> Logger wrapped <span style="color:#f92672">=</span> LogManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getLogger</span><span style="color:#f92672">(</span>clazz<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> SimpleCustomLogger<span style="color:#f92672">(</span>wrapped<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">info</span><span style="color:#f92672">(</span>Object message<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>log<span style="color:#f92672">.</span><span style="color:#a6e22e">isInfoEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
      log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span>message<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>which is used in a Spring Boot Component like so</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> org.springframework.stereotype.Component<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@Component</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomComponent</span>
<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> SimpleCustomLogger logger <span style="color:#f92672">=</span> SimpleCustomLogger<span style="color:#f92672">.</span><span style="color:#a6e22e">getLogger</span><span style="color:#f92672">(</span>CustomComponent<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doSomething</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        logger<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello from the Simple Custom Logger&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="the-power-of-the-listappender">The power of the ListAppender</h2>
<p>The trick of the <code>ListAppender</code> showed in my <a href="https://www.alebaffa.com/2018/03/17/unit-testing-custom-logger-log4j2/">last post</a> works exactly the same here. It will listen to all the events that are happening to the logger it is attached to.</p>
<p>Here the log4j2.xml:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Configuration</span> <span style="color:#a6e22e">status=</span><span style="color:#e6db74">&#34;DEBUG&#34;</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;TestCustomLogger&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;Appenders&gt;</span>
    <span style="color:#f92672">&lt;Console</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;STDOUT&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;PatternLayout</span> <span style="color:#a6e22e">pattern=</span><span style="color:#e6db74">&#34;%m%n&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/Console&gt;</span>
    <span style="color:#f92672">&lt;List</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;List1&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/Appenders&gt;</span>
<span style="color:#f92672">&lt;Loggers&gt;</span>
    <span style="color:#f92672">&lt;Root</span> <span style="color:#a6e22e">level=</span><span style="color:#e6db74">&#34;DEBUG&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;AppenderRef</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;STDOUT&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;AppenderRef</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;List1&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/Root&gt;</span>
<span style="color:#f92672">&lt;/Loggers&gt;</span>
<span style="color:#f92672">&lt;/Configuration&gt;</span>
</code></pre></div><p>and here unit test:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RunWith</span><span style="color:#f92672">(</span>SpringRunner<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@SpringBootTest</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleCustomLoggerTest</span> <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Autowired</span>
  CustomComponent component<span style="color:#f92672">;</span>

  <span style="color:#a6e22e">@ClassRule</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> LoggerContextRule context <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LoggerContextRule<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;log4j2.xml&#34;</span><span style="color:#f92672">);</span>
  <span style="color:#66d9ef">private</span> ListAppender listAppender<span style="color:#f92672">;</span>

  <span style="color:#a6e22e">@Before</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span><span style="color:#f92672">(){</span>
    listAppender <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span><span style="color:#a6e22e">getListAppender</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;List1&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
  <span style="color:#f92672">}</span>

  <span style="color:#a6e22e">@Test</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testCustomComponent</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// This will write something with the custom logger
</span><span style="color:#75715e"></span>    component<span style="color:#f92672">.</span><span style="color:#a6e22e">doSomething</span><span style="color:#f92672">();</span> 
    <span style="color:#75715e">// Retrieve the ListAppender
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;</span>LogEvent<span style="color:#f92672">&gt;</span> events <span style="color:#f92672">=</span> listAppender<span style="color:#f92672">.</span><span style="color:#a6e22e">getEvents</span><span style="color:#f92672">();</span>
    
    assertThat<span style="color:#f92672">(</span>events<span style="color:#f92672">,</span> hasSize<span style="color:#f92672">(</span>1<span style="color:#f92672">));</span>
    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Custom logger is catched by the ListAppender&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;Hello from the Simple Custom Logger&#34;</span><span style="color:#f92672">,</span>
        events<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">).</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getFormattedMessage</span><span style="color:#f92672">());</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Unit testing a custom logger with log4j2 is really super simple.</p>

    </div>
    
</section>
<footer id="footer">
    <strong></strong>
    <div class="social">
        &nbsp; <a href="https://twitter.com/alebaffa" target="_blank" rel="noopener" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a> &nbsp;&nbsp; <a href="https://github.com/alebaffa" target="_blank" rel="noopener" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a> &nbsp;&nbsp; <a href="https://www.linkedin.com/alessandrobaffa" target="_blank" rel="noopener" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a> &nbsp;&nbsp; <a href="https://www.facebook.com/alessandro.baffa" target="_blank" rel="noopener" title="Facebook"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a> &nbsp;
    </div><strong></strong>
    <p style="color:grey;">© 2021 Alessandro Baffa.  <a href="https://creativecommons.org/licenses/by/4.0/">Some rights reserved</a>.</p>
</footer>
</div>
    </body>
</html>
